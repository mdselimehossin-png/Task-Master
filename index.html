<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Take Master - Earn Money Online</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#4a90e2;
  --secondary:#50e3c2;
  --accent:#f5a623;
  --green:#2ecc71;
  --red:#e74c3c;
  --gold:#ffd700;
  --background:#0f0f1e;
  --card:#1a1a2e;
  --card-light:#252541;
  --text-primary:#ffffff;
  --text-secondary:#b8b8d4;
  --shadow:0 4px 12px rgba(0,0,0,0.3);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  margin:0;
  font-family:'Roboto',sans-serif;
  background:linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #1a1a2e 100%);
  background-size:400% 400%;
  animation:gradientShift 15s ease infinite;
  color:var(--text-primary);
}
@keyframes gradientShift{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 20px rgba(102,126,234,0.4); }
  50% { box-shadow: 0 0 30px rgba(102,126,234,0.6); }
}
@keyframes shine {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}
.container{
  max-width:450px;
  margin:20px auto;
  background:var(--card);
  border-radius:15px;
  box-shadow:var(--shadow);
  overflow:hidden;
  min-height:90vh;
  padding-bottom:50px;
  border:1px solid rgba(255,255,255,0.1);
}

/* Header */
.main-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:15px;
  position:sticky;
  top:0;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  z-index:10;
  box-shadow:0 2px 10px rgba(0,0,0,0.3);
}
.menu-btn{
  background:rgba(255,255,255,0.2);
  color:#fff;
  font-size:20px;
  border:none;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
  transition:0.3s;
}
.menu-btn:hover{background:rgba(255,255,255,0.3);}
.header-title{
  font-weight:700;
  color:#fff;
  font-size:18px;
  text-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.notification-icon{
  font-size:24px;
  cursor:pointer;
  position:relative;
  color:#fff;
}
.notification-count{
  position:absolute;
  top:-5px;
  right:-10px;
  background:var(--red);
  color:#fff;
  border-radius:50%;
  font-size:11px;
  padding:3px 7px;
  min-width:20px;
  text-align:center;
}

/* Sidebar */
.menu-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:50;}
.side-menu{
  position:fixed;
  top:0;
  left:0;
  height:100vh;
  width:260px;
  background:var(--card);
  box-shadow:3px 0 20px rgba(0,0,0,0.5);
  transform:translateX(-100%);
  transition:transform 0.3s ease;
  z-index:60;
  overflow-y:auto;
  border-right:1px solid rgba(255,255,255,0.1);
}
.side-menu.open{transform:translateX(0);}
.drawer-header{
  padding:20px;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.drawer-title{font-weight:700;color:#fff;font-size:18px;}
.drawer-close{
  background:rgba(255,255,255,0.2);
  border:none;
  padding:8px 12px;
  border-radius:50%;
  cursor:pointer;
  font-size:18px;
  color:#fff;
}
.menu-list{list-style:none;padding:10px 0;margin:0;}
.menu-list li{
  padding:14px 20px;
  font-weight:500;
  border-bottom:1px solid rgba(255,255,255,0.05);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:12px;
  transition:0.2s;
  color:var(--text-secondary);
}
.menu-list li:hover{background:rgba(102,126,234,0.2);color:var(--text-primary);}
.menu-list .active{background:rgba(102,126,234,0.3);color:var(--text-primary);font-weight:700;border-left:4px solid var(--primary);}

/* Profile Card */
.profile-card{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  border-radius:20px;
  box-shadow:0 8px 20px rgba(102,126,234,0.4);
  padding:20px;
  margin:15px;
  position:relative;
  overflow:hidden;
}
.profile-content{
  position:relative;
  z-index:1;
  display:flex;
  align-items:center;
  gap:15px;
}
.profile-icon .avatar{
  width:80px;
  height:80px;
  border-radius:50%;
  background:linear-gradient(135deg,#ffd89b 0%,#19547b 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:45px;
  border:4px solid rgba(255,255,255,0.3);
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
.profile-details{flex:1;}
.pname{
  color:#fff;
  font-weight:700;
  font-size:20px;
  text-shadow:0 2px 4px rgba(0,0,0,0.2);
  margin-bottom:5px;
}
.pphone,.pid{
  font-size:13px;
  color:rgba(255,255,255,0.9);
  margin:3px 0;
}
.pbalance{
  font-weight:700;
  color:#fff;
  margin-top:8px;
  font-size:16px;
  background:rgba(255,255,255,0.2);
  padding:8px 12px;
  border-radius:8px;
  display:inline-block;
}
.pbalance span{
  font-size:20px;
  color:#ffd700;
}

/* Notice Board */
.notice-board{
  background:linear-gradient(135deg,rgba(255,193,7,0.2) 0%,rgba(255,152,0,0.2) 100%);
  color:#ffd54f;
  border:1px solid rgba(255,193,7,0.3);
  border-radius:12px;
  padding:12px 16px;
  margin:10px 15px;
  font-size:14px;
  border-left:5px solid var(--accent);
}
.notice-board strong{
  color:#ffc107;
  display:inline-block;
  margin-right:5px;
}

/* Daily Task Board */
.daily-task-board{
  background:linear-gradient(135deg,rgba(76,175,80,0.15) 0%,rgba(46,204,113,0.15) 100%);
  border-radius:15px;
  margin:15px;
  padding:15px;
  border-top:4px solid var(--green);
  border:1px solid rgba(46,204,113,0.3);
}
.daily-task-title{
  color:#4caf50;
  font-weight:700;
  font-size:18px;
  margin-bottom:15px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.daily-timer{
  font-size:14px;
  background:rgba(46,204,113,0.2);
  padding:6px 12px;
  border-radius:20px;
  color:#81c784;
}
.daily-task-box{
  background:var(--card-light);
  border-radius:10px;
  padding:15px;
  margin-bottom:10px;
  border-left:3px solid var(--green);
}
.daily-task-info{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.daily-task-name{
  font-weight:600;
  color:var(--text-primary);
  font-size:15px;
}
.daily-task-reward{
  background:linear-gradient(135deg,#ffd700 0%,#ffed4e 100%);
  color:#000;
  padding:4px 12px;
  border-radius:15px;
  font-weight:700;
  font-size:13px;
}
.daily-progress-bar{
  background:rgba(255,255,255,0.1);
  height:8px;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:10px;
}
.daily-progress-fill{
  background:linear-gradient(90deg,#4caf50 0%,#81c784 100%);
  height:100%;
  transition:width 0.3s;
}
.daily-claim-btn{
  width:100%;
  padding:10px;
  background:linear-gradient(135deg,var(--green) 0%,#27ae60 100%);
  color:#fff;
  border:none;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  transition:0.3s;
}
.daily-claim-btn:hover{transform:scale(1.02);}
.daily-claim-btn:disabled{
  background:#555;
  cursor:not-allowed;
  opacity:0.6;
}

/* Task Board */
.task-board{
  background:linear-gradient(135deg,rgba(33,150,243,0.1) 0%,rgba(103,58,183,0.1) 100%);
  border-radius:15px;
  margin:15px;
  padding:15px;
  border-top:4px solid var(--primary);
  border:1px solid rgba(74,144,226,0.3);
}
.task-title{
  color:#64b5f6;
  font-weight:700;
  font-size:18px;
  margin-bottom:15px;
  display:flex;
  align-items:center;
  gap:8px;
}
.task-box{
  background:var(--card-light);
  border-radius:8px;
  box-shadow:0 1px 5px rgba(0,0,0,0.3);
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
  transition:0.3s;
  border-left:3px solid transparent;
}
.task-box:hover{
  transform:translateY(-1px);
  box-shadow:0 2px 8px rgba(102,126,234,0.3);
  border-left-color:var(--primary);
}
.task-box.completed{
  background:rgba(46,204,113,0.1);
  border-left-color:var(--green);
  opacity:0.7;
}
.task-info{flex:1;}
.task-info strong{
  display:block;
  color:var(--text-primary);
  margin-bottom:3px;
  font-size:14px;
}
.task-reward{
  font-size:12px;
  color:var(--accent);
  font-weight:600;
}
.task-actions{
  display:flex;
  gap:8px;
  align-items:center;
}
.claim-btn,.complete-btn{
  padding:8px 15px;
  font-size:13px;
  font-weight:700;
  border:none;
  border-radius:6px;
  cursor:pointer;
  transition:0.3s;
  white-space:nowrap;
}
.claim-btn{
  background:linear-gradient(135deg,var(--green) 0%,#27ae60 100%);
  color:#fff;
}
.claim-btn:hover{transform:scale(1.05);}
.complete-btn{
  background:linear-gradient(135deg,var(--primary) 0%,#3a7bc8 100%);
  color:#fff;
}
.complete-btn:hover{transform:scale(1.05);}
.completed-badge{
  background:var(--green);
  color:#fff;
  padding:5px 12px;
  border-radius:5px;
  font-size:12px;
  font-weight:700;
}

/* Sections */
.section{
  border-radius:15px;
  margin:15px;
  padding:20px;
  background:var(--card);
  box-shadow:var(--shadow);
  display:none;
  border:1px solid rgba(255,255,255,0.1);
}
.section.active{display:block;}
.section h2{
  font-size:22px;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-bottom:20px;
}
.back-btn{
  background:linear-gradient(135deg,rgba(255,255,255,0.1) 0%,rgba(255,255,255,0.05) 100%);
  color:var(--text-primary);
  border:1px solid rgba(255,255,255,0.2);
  padding:10px 18px;
  border-radius:8px;
  margin:0 0 15px 0;
  cursor:pointer;
  transition:0.3s;
  font-weight:600;
  display:inline-flex;
  align-items:center;
  gap:5px;
}
.back-btn:hover{
  background:linear-gradient(135deg,rgba(255,255,255,0.2) 0%,rgba(255,255,255,0.1) 100%);
  transform:translateX(-3px);
}

/* Coin Converter */
.coin-converter{
  background:var(--card-light);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,0.1);
}
.converter-title{
  font-weight:700;
  color:var(--text-primary);
  margin-bottom:15px;
  font-size:16px;
  display:flex;
  align-items:center;
  gap:8px;
}
.converter-row{
  display:flex;
  gap:15px;
  align-items:center;
  margin-bottom:10px;
}
.converter-input{
  flex:1;
}
.converter-input input{
  width:100%;
  padding:12px;
  border:2px solid rgba(255,255,255,0.1);
  background:var(--card);
  color:var(--text-primary);
  border-radius:8px;
  font-size:15px;
  outline:none;
}
.converter-input input:focus{
  border-color:var(--primary);
}
.converter-label{
  font-size:14px;
  color:var(--text-secondary);
  margin-bottom:5px;
}
.converter-rate{
  font-size:12px;
  color:var(--text-secondary);
  text-align:center;
  margin-top:8px;
}

/* Withdraw */
.balance-display{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:#fff;
  padding:20px;
  border-radius:12px;
  text-align:center;
  margin-bottom:20px;
}
.balance-display .label{
  font-size:14px;
  opacity:0.9;
  margin-bottom:5px;
}
.balance-display .amount{
  font-size:36px;
  font-weight:700;
}
.withdraw-methods{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-bottom:20px;
}
.method-btn{
  padding:15px;
  border:2px solid rgba(255,255,255,0.2);
  border-radius:10px;
  background:var(--card-light);
  cursor:pointer;
  transition:0.3s;
  text-align:center;
  font-weight:600;
  color:var(--text-secondary);
}
.method-btn:hover{
  border-color:var(--primary);
  background:rgba(102,126,234,0.2);
  color:var(--text-primary);
}
.method-btn.active{
  border-color:var(--primary);
  background:rgba(102,126,234,0.2);
  color:#64b5f6;
}

/* Form */
.form-group{
  margin-bottom:15px;
}
.form-group label{
  display:block;
  font-weight:600;
  margin-bottom:8px;
  color:var(--text-primary);
}
.form-group input,.form-group textarea{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:2px solid rgba(255,255,255,0.1);
  background:var(--card-light);
  color:var(--text-primary);
  font-size:15px;
  outline:none;
  transition:0.3s;
  font-family:'Roboto',sans-serif;
}
.form-group input:focus,.form-group textarea:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(74,144,226,0.2);
  background:rgba(102,126,234,0.1);
}
.form-group input::placeholder,.form-group textarea::placeholder{
  color:rgba(184,184,212,0.5);
}
.submit-btn{
  width:100%;
  padding:14px;
  background:linear-gradient(135deg,var(--primary) 0%,#3a7bc8 100%);
  color:#fff;
  border:none;
  border-radius:10px;
  font-weight:700;
  margin-top:10px;
  cursor:pointer;
  font-size:16px;
  transition:0.3s;
}
.submit-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 15px rgba(74,144,226,0.4);
}
.submit-btn:disabled{
  background:#555;
  cursor:not-allowed;
  transform:none;
  opacity:0.6;
}

/* Auth */
.auth-container{
  max-width:400px;
  margin:50px auto;
  background:var(--card);
  padding:30px;
  border-radius:20px;
  box-shadow:0 8px 30px rgba(0,0,0,0.5);
  border:1px solid rgba(255,255,255,0.1);
}
.auth-container h2{
  text-align:center;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-bottom:20px;
  font-size:26px;
}
.app-logo{
  text-align:center;
  font-size:60px;
  margin-bottom:10px;
}
.signup-fields{display:none;}
.auth-container input{
  width:100%;
  padding:14px;
  margin:10px 0;
  border-radius:10px;
  border:2px solid rgba(255,255,255,0.1);
  background:var(--card-light);
  color:var(--text-primary);
  font-size:15px;
  outline:none;
  transition:0.3s;
}
.auth-container input::placeholder{
  color:rgba(184,184,212,0.5);
}
.auth-container input:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(74,144,226,0.2);
  background:rgba(102,126,234,0.1);
}
.auth-container button{
  width:100%;
  padding:14px;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  border:none;
  color:#fff;
  font-weight:700;
  border-radius:10px;
  cursor:pointer;
  margin-top:10px;
  transition:0.3s;
  font-size:16px;
}
.auth-container button:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 15px rgba(102,126,234,0.4);
}
.toggle-auth{
  text-align:center;
  font-size:14px;
  margin-top:15px;
  cursor:pointer;
  color:var(--secondary);
  font-weight:500;
}
.toggle-auth:hover{text-decoration:underline;}
.error-msg{
  color:#ff6b6b;
  font-size:13px;
  margin:8px 0;
  display:none;
  padding:10px;
  background:rgba(255,107,107,0.2);
  border-radius:6px;
  border-left:3px solid var(--red);
}
.success-msg{
  color:#51cf66;
  font-size:13px;
  margin:8px 0;
  display:none;
  padding:10px;
  background:rgba(81,207,102,0.2);
  border-radius:6px;
  border-left:3px solid var(--green);
}

/* Wallet Cards */
.wallet-cards{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
  margin-bottom:25px;
}
.wallet-card{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  padding:20px;
  border-radius:12px;
  color:#fff;
  text-align:center;
}
.wallet-card.green{
  background:linear-gradient(135deg,var(--green) 0%,#27ae60 100%);
}
.wallet-card.gold{
  background:linear-gradient(135deg,var(--accent) 0%,#f76b1c 100%);
}
.wallet-card .icon{
  font-size:32px;
  margin-bottom:10px;
}
.wallet-card .amount{
  font-size:28px;
  font-weight:700;
  margin-bottom:5px;
}
.wallet-card .label{
  font-size:12px;
  opacity:0.9;
}

/* Refer */
.refer-stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
  margin-bottom:20px;
}
.stat-card{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  padding:20px;
  border-radius:12px;
  text-align:center;
  color:#fff;
}
.stat-card .number{
  font-size:32px;
  font-weight:700;
  margin-bottom:5px;
}
.stat-card .label{
  font-size:13px;
  opacity:0.9;
}
.refer-link-box{
  background:var(--card-light);
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,0.1);
}
.link-input-group{
  display:flex;
  gap:10px;
}
.link-input-group input{
  flex:1;
  padding:12px;
  border:2px solid rgba(255,255,255,0.1);
  background:var(--card);
  color:var(--text-primary);
  border-radius:8px;
  font-size:14px;
  outline:none;
}
.copy-btn{
  padding:12px 20px;
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  transition:0.3s;
}
.copy-btn:hover{
  transform:scale(1.05);
}

/* Referral Rewards Section */
.referral-rewards{
  background:linear-gradient(135deg,rgba(76,175,80,0.15) 0%,rgba(46,204,113,0.15) 100%);
  border-radius:12px;
  padding:20px;
  margin-bottom:20px;
  border:1px solid rgba(46,204,113,0.3);
}
.reward-title{
  color:#4caf50;
  font-weight:700;
  margin-bottom:15px;
  font-size:16px;
  display:flex;
  align-items:center;
  gap:8px;
}
.reward-box{
  background:var(--card-light);
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
  border-left:3px solid var(--green);
}
.reward-info{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.reward-desc{
  font-size:14px;
  color:var(--text-primary);
  font-weight:600;
}
.reward-amount{
  background:linear-gradient(135deg,#ffd700 0%,#ffed4e 100%);
  color:#000;
  padding:5px 15px;
  border-radius:20px;
  font-weight:700;
  font-size:14px;
}
.reward-progress{
  background:rgba(255,255,255,0.1);
  height:8px;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:10px;
}
.reward-progress-fill{
  background:linear-gradient(90deg,#4caf50 0%,#81c784 100%);
  height:100%;
  transition:width 0.3s;
}
.reward-claim-btn{
  width:100%;
  padding:10px;
  background:linear-gradient(135deg,var(--green) 0%,#27ae60 100%);
  color:#fff;
  border:none;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  transition:0.3s;
  font-size:14px;
}
.reward-claim-btn:hover{transform:scale(1.02);}
.reward-claim-btn:disabled{
  background:#555;
  cursor:not-allowed;
  opacity:0.6;
}

/* Leaderboard */
.leaderboard-container{
  background:var(--card-light);
  border-radius:12px;
  padding:15px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,0.1);
}
.leaderboard-item{
  background:var(--card);
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:15px;
  transition:0.3s;
  border-left:3px solid transparent;
}
.leaderboard-item:hover{
  transform:translateX(8px) scale(1.02);
  box-shadow:0 4px 20px rgba(102,126,234,0.3);
  border-left-color:var(--primary);
}
.leaderboard-item.top1{
  background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,193,7,0.2));
  border-left-color:#ffd700;
  position:relative;
  overflow:hidden;
}
.leaderboard-item.top1::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255,215,0,0.1), transparent);
  animation: shine 3s ease-in-out infinite;
}
.leaderboard-item.top2{
  background:linear-gradient(135deg,rgba(192,192,192,0.2),rgba(169,169,169,0.2));
  border-left-color:#c0c0c0;
}
.leaderboard-item.top3{
  background:linear-gradient(135deg,rgba(205,127,50,0.2),rgba(184,115,51,0.2));
  border-left-color:#cd7f32;
}
.leaderboard-item.current-user{
  background:linear-gradient(135deg,rgba(102,126,234,0.3),rgba(118,75,162,0.3));
  border-left-color:var(--primary);
  animation: pulse 2s ease-in-out infinite;
}
.rank-badge{
  width:50px;
  height:50px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:20px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
  flex-shrink:0;
}
.rank-badge.gold{
  background:linear-gradient(135deg,#ffd700,#ffa500);
  color:#000;
}
.rank-badge.silver{
  background:linear-gradient(135deg,#c0c0c0,#a9a9a9);
  color:#000;
}
.rank-badge.bronze{
  background:linear-gradient(135deg,#cd7f32,#b8732b);
  color:#000;
}
.leaderboard-info{
  flex:1;
}
.leaderboard-name{
  font-weight:700;
  color:var(--text-primary);
  font-size:16px;
  margin-bottom:5px;
}
.leaderboard-earned{
  font-size:14px;
  color:var(--text-secondary);
}
.leaderboard-earned span{
  color:#ffd700;
  font-weight:700;
}

/* Notifications */
.notification-item{
  background:var(--card-light);
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
  border-left:3px solid var(--primary);
  transition:0.3s;
}
.notification-item:hover{
  transform:translateX(5px);
}
.notification-item.unread{
  background:rgba(102,126,234,0.1);
  border-left-color:#ffd700;
}
.notification-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.notification-title{
  font-weight:700;
  color:var(--text-primary);
  font-size:15px;
}
.notification-date{
  font-size:11px;
  color:var(--text-secondary);
}
.notification-message{
  font-size:14px;
  color:var(--text-secondary);
  line-height:1.5;
}
.notification-badge{
  background:#ffd700;
  color:#000;
  padding:3px 8px;
  border-radius:10px;
  font-size:10px;
  font-weight:700;
  margin-left:8px;
}

/* Profile Settings */
.profile-settings-card{
  background:var(--card-light);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,0.1);
}
.profile-settings-card h3{
  color:var(--text-primary);
  margin-bottom:15px;
  font-size:18px;
}
.profile-info-row{
  display:flex;
  justify-content:space-between;
  padding:12px 0;
  border-bottom:1px solid rgba(255,255,255,0.05);
}
.profile-info-label{
  color:var(--text-secondary);
  font-size:14px;
}
.profile-info-value{
  color:var(--text-primary);
  font-weight:600;
  font-size:14px;
}

/* Mobile Responsive */
@media (max-width: 480px) {
  .leaderboard-item {
    padding: 12px;
    gap: 10px;
  }
  .rank-badge {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }
  .leaderboard-name {
    font-size: 14px;
  }
  .leaderboard-earned {
    font-size: 12px;
  }
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

<!-- Auth Section -->
<div id="auth-section" class="auth-container">
  <div class="app-logo">üìã</div>
  <h2 id="auth-title">Take Master</h2>
  
  <div class="signup-fields" id="signup-fields">
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="text" id="signup-phone" placeholder="Phone Number (01XXXXXXXXX)">
  </div>
  
  <input type="email" id="auth-email" placeholder="Email Address">
  <input type="password" id="auth-password" placeholder="Password (min 6 characters)">
  
  <span class="error-msg" id="auth-error"></span>
  
  <button id="auth-btn" onclick="handleAuth()">Login</button>
  
  <div class="toggle-auth" id="toggle-auth" onclick="toggleAuthMode()">
    Don't have an account? Sign Up
  </div>
</div>

<!-- User Dashboard -->
<div id="dashboard" class="container" style="display:none;">
  <div class="main-header">
    <button class="menu-btn" onclick="openMenu()">‚ò∞</button>
    <div class="header-title">Take Master</div>
    <div class="notification-icon" onclick="showSection('notifications-section')">üîî
      <span class="notification-count" id="notification-count" style="display:none;">0</span>
    </div>
  </div>

  <!-- Profile Card -->
  <div class="profile-card">
    <div class="profile-content">
      <div class="profile-icon">
        <div class="avatar">üë§</div>
      </div>
      <div class="profile-details">
        <div class="pname" id="user-name">User Name</div>
        <div class="pphone" id="user-phone">üì± 0000000000</div>
        <div class="pid" id="user-uid">üÜî TM000000</div>
        <div class="pbalance">üí∞ Balance: <span id="user-balance">0</span> coins</div>
      </div>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div id="dashboard-content">
    <div class="notice-board">
      <strong>üì¢ Notice:</strong>
      <span id="notice-text">Welcome to Take Master Dashboard!</span>
    </div>

    <!-- Daily Tasks Section -->
    <div class="daily-task-board">
      <div class="daily-task-title">
        <span id="daily-task-heading">üéÅ Daily Tasks</span>
        <span class="daily-timer" id="daily-timer">00:00:00</span>
      </div>
      
      <div class="daily-task-box">
        <div class="daily-task-info">
          <div class="daily-task-name">Daily Login Bonus</div>
          <div class="daily-task-reward" id="daily-login-reward-badge">+50 Coins</div>
        </div>
        <div class="daily-progress-bar">
          <div class="daily-progress-fill" id="login-progress" style="width:0%"></div>
        </div>
        <button class="daily-claim-btn" id="daily-login-btn" onclick="claimDailyLogin()">Claim Reward</button>
      </div>

      <div class="daily-task-box">
        <div class="daily-task-info">
          <div class="daily-task-name">Complete 3 Tasks</div>
          <div class="daily-task-reward" id="daily-task-reward-badge">+100 Coins</div>
        </div>
        <div class="daily-progress-bar">
          <div class="daily-progress-fill" id="task-progress" style="width:0%"></div>
        </div>
        <button class="daily-claim-btn" id="daily-task-btn" onclick="claimDailyTask()" disabled>0/3 Completed</button>
      </div>
    </div>
  </div>

  <!-- Tasks Section -->
  <div id="tasks-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üìã Available Tasks</h2>
    <div id="tasks-list">Loading...</div>
  </div>

  <!-- Withdraw Section -->
  <div id="withdraw-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üí∏ Withdraw Balance</h2>
    
    <div class="notice-board" style="margin:0 0 20px 0;">
      <strong>üì¢ Important:</strong>
      <span id="withdraw-notice-text">Please ensure your account details are correct before submitting withdrawal request.</span>
    </div>

    <div class="balance-display">
      <div class="label">Available Balance</div>
      <div class="amount" id="withdraw-balance">0</div>
      <div class="label">coins</div>
    </div>

    <div class="coin-converter">
      <div class="converter-title">üí± Coin to BDT Converter</div>
      <div class="converter-row">
        <div class="converter-input">
          <div class="converter-label">Enter Coins</div>
          <input type="number" id="converter-coins" placeholder="100" onkeyup="convertCoins()" onchange="convertCoins()">
        </div>
        <div style="font-size:24px;color:var(--text-secondary);">=</div>
        <div class="converter-input">
          <div class="converter-label">BDT Amount</div>
          <input type="text" id="converter-bdt" placeholder="0.00" readonly style="background:var(--card-light);">
        </div>
      </div>
      <div class="converter-rate">
        Current Rate: 1 Coin = <span id="display-coin-rate">1</span> BDT
      </div>
    </div>
    
    <div class="withdraw-methods">
      <div class="method-btn active" onclick="selectMethod('bkash')">üì± bKash</div>
      <div class="method-btn" onclick="selectMethod('nagad')">üì± Nagad</div>
      <div class="method-btn" onclick="selectMethod('rocket')">üöÄ Rocket</div>
      <div class="method-btn" onclick="selectMethod('bank')">üè¶ Bank</div>
    </div>
    
    <div class="form-group">
      <input type="text" id="withdraw-method" value="bkash" readonly placeholder="Payment Method">
    </div>
    
    <div class="form-group">
      <input type="text" id="withdraw-account" placeholder="Account Number / Bank Details">
    </div>
    
    <div class="form-group">
      <input type="number" id="withdraw-amount" placeholder="Amount in Coins (Minimum 100)" onkeyup="convertCoins()" onchange="convertCoins()">
    </div>
    
    <span class="error-msg" id="withdraw-error"></span>
    <span class="success-msg" id="withdraw-success"></span>
    
    <button class="submit-btn" id="withdraw-submit-btn" onclick="submitWithdraw()">üí∏ Request Withdraw</button>
  </div>

  <!-- Refer Section -->
  <div id="refer-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üéÅ Refer & Earn</h2>
    
    <div class="refer-stats">
      <div class="stat-card">
        <div class="number" id="total-referrals">0</div>
        <div class="label">Total Referrals</div>
      </div>
      <div class="stat-card">
        <div class="number" id="refer-earnings">0</div>
        <div class="label">Total Earned</div>
      </div>
    </div>
    
    <div class="refer-link-box">
      <label style="font-weight:600;margin-bottom:8px;display:block;color:var(--text-primary);">üîó Your Referral Link</label>
      <div class="link-input-group">
        <input type="text" id="refer-link" readonly>
        <button class="copy-btn" onclick="copyReferLink()">üìã Copy</button>
      </div>
    </div>

    <div class="referral-rewards">
      <div class="reward-title">üéÅ Referral Rewards</div>
      
      <div class="reward-box">
        <div class="reward-info">
          <div class="reward-desc">Invite 1 Friend Today</div>
          <div class="reward-amount" id="daily-refer-reward-badge">+75 Coins</div>
        </div>
        <div class="reward-progress">
          <div class="reward-progress-fill" id="daily-refer-progress" style="width:0%"></div>
        </div>
        <button class="reward-claim-btn" id="daily-refer-btn" onclick="claimDailyRefer()" disabled>0/1 Invited Today</button>
      </div>

      <div class="reward-box">
        <div class="reward-info">
          <div class="reward-desc">Invite 5 Friends Total</div>
          <div class="reward-amount" id="total-5-refer-reward-badge">+200 Coins</div>
        </div>
        <div class="reward-progress">
          <div class="reward-progress-fill" id="total-5-refer-progress" style="width:0%"></div>
        </div>
        <button class="reward-claim-btn" id="total-5-refer-btn" onclick="claimTotalRefer(5)" disabled>0/5 Invited</button>
      </div>

      <div class="reward-box">
        <div class="reward-info">
          <div class="reward-desc">Invite 10 Friends Total</div>
          <div class="reward-amount" id="total-10-refer-reward-badge">+500 Coins</div>
        </div>
        <div class="reward-progress">
          <div class="reward-progress-fill" id="total-10-refer-progress" style="width:0%"></div>
        </div>
        <button class="reward-claim-btn" id="total-10-refer-btn" onclick="claimTotalRefer(10)" disabled>0/10 Invited</button>
      </div>
    </div>
  </div>

  <!-- Leaderboard Section -->
  <div id="leaderboard-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üèÜ Leaderboard</h2>
    
    <div style="text-align:right;margin-bottom:15px;">
      <button onclick="loadLeaderboard()" style="padding:8px 16px;background:linear-gradient(135deg,var(--primary),#3a7bc8);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;transition:0.3s;">
        üîÑ Refresh
      </button>
    </div>
    
    <div class="leaderboard-container" id="leaderboard-list">
      <div style="text-align:center;padding:20px;color:var(--text-secondary);">Loading...</div>
    </div>
  </div>

  <!-- Notifications Section -->
  <div id="notifications-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üîî Notifications</h2>
    
    <div id="notifications-list">
      <div style="text-align:center;padding:20px;color:var(--text-secondary);">No notifications</div>
    </div>
  </div>

  <!-- Profile Settings Section -->
  <div id="profile-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üë§ Profile Settings</h2>
    
    <div class="profile-settings-card">
      <h3>üìã Personal Information</h3>
      <div class="profile-info-row">
        <div class="profile-info-label">Full Name</div>
        <div class="profile-info-value" id="profile-name">Loading...</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Phone Number</div>
        <div class="profile-info-value" id="profile-phone">Loading...</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Email Address</div>
        <div class="profile-info-value" id="profile-email">Loading...</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">User ID</div>
        <div class="profile-info-value" id="profile-uid">Loading...</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Member Since</div>
        <div class="profile-info-value" id="profile-joined">Loading...</div>
      </div>
    </div>

    <div class="profile-settings-card">
      <h3>üí∞ Account Summary</h3>
      <div class="profile-info-row">
        <div class="profile-info-label">Current Balance</div>
        <div class="profile-info-value" id="profile-balance">0 coins</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Total Earned</div>
        <div class="profile-info-value" id="profile-earned">0 coins</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Total Withdrawn</div>
        <div class="profile-info-value" id="profile-withdrawn">0 coins</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Pending Withdraw</div>
        <div class="profile-info-value" id="profile-pending">0 coins</div>
      </div>
      <div class="profile-info-row">
        <div class="profile-info-label">Total Referrals</div>
        <div class="profile-info-value" id="profile-referrals">0</div>
      </div>
    </div>
  </div>

  <!-- Wallet Section -->
  <div id="wallet-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üíº My Wallet</h2>
    
    <div class="wallet-cards">
      <div class="wallet-card">
        <div class="icon">üí∞</div>
        <div class="amount" id="wallet-current-balance">0</div>
        <div class="label">Current Balance</div>
      </div>
      
      <div class="wallet-card green">
        <div class="icon">üìà</div>
        <div class="amount" id="wallet-total-earned">0</div>
        <div class="label">Total Earned</div>
      </div>
      
      <div class="wallet-card gold">
        <div class="icon">üì§</div>
        <div class="amount" id="wallet-withdrawn">0</div>
        <div class="label">Total Withdrawn</div>
      </div>
      
      <div class="wallet-card">
        <div class="icon">‚è≥</div>
        <div class="amount" id="wallet-pending">0</div>
        <div class="label">Pending</div>
      </div>
    </div>
  </div>

  <!-- Help Section -->
  <div id="help-section" class="section">
    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back</button>
    <h2>üí¨ Message to Admin</h2>
    
    <div class="form-group">
      <label>Subject</label>
      <input type="text" id="help-subject" placeholder="Subject (e.g., Payment Issue)">
    </div>
    
    <div class="form-group">
      <label>Message</label>
      <textarea placeholder="Write your message in detail..." rows="6" id="help-message"></textarea>
    </div>
    
    <span class="error-msg" id="help-error"></span>
    <span class="success-msg" id="help-success"></span>
    
    <button class="submit-btn" id="help-submit-btn" onclick="submitHelp()">üì§ Send Message</button>
  </div>

  <!-- Sidebar Menu -->
  <div class="menu-bg" onclick="closeMenu()"></div>
  <div class="side-menu" id="side-menu">
    <div class="drawer-header">
      <span class="drawer-title">Menu</span>
      <button class="drawer-close" onclick="closeMenu()">√ó</button>
    </div>
    <ul class="menu-list">
      <li class="active" onclick="showSection('dashboard')">üè† Dashboard</li>
      <li onclick="showSection('profile-section')">üë§ Profile Settings</li>
      <li onclick="showSection('tasks-section')">üìã Tasks</li>
      <li onclick="showSection('leaderboard-section')">üèÜ Leaderboard</li>
      <li onclick="showSection('withdraw-section')">üí∏ Withdraw</li>
      <li onclick="showSection('refer-section')">üîó Refer & Earn</li>
      <li onclick="showSection('wallet-section')">üíº My Wallet</li>
      <li onclick="showSection('notifications-section')">üîî Notifications</li>
      <li onclick="showSection('help-section')">üí¨ Message Admin</li>
      <li onclick="logout()" style="color:var(--red);">üö™ Logout</li>
    </ul>
  </div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyD6NfQHIlegwL2dU996GqqLT-BCk35U7Js",
  authDomain: "taskmaster-2c470.firebaseapp.com",
  databaseURL: "https://taskmaster-2c470-default-rtdb.firebaseio.com",
  projectId: "taskmaster-2c470",
  storageBucket: "taskmaster-2c470.firebasestorage.app",
  messagingSenderId: "975980927095",
  appId: "1:975980927095:web:d2c46612fa1f62e6c48e72"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
let userBalance = 0;
let isSignupMode = false;
let completedTasks = {};
let totalEarned = 0;
let userData = {};
let selectedWithdrawMethod = 'bkash';
let coinRate = 1;
let minWithdrawAmount = 100;
let dailyData = {};

let rewardSettings = {
  dailyLogin: 50,
  dailyTask: 100,
  signupReferralBonus: 50,
  dailyRefer: 75,
  total5Refer: 200,
  total10Refer: 500,
  taskCommissionRate: 10
};

console.log('üöÄ Take Master User Panel Initialized');

// Generate User ID
function generateUserID() {
  const timestamp = Date.now().toString().slice(-6);
  const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
  return 'TM' + timestamp + random;
}

// Load Reward Settings
function loadRewardSettings(){
  db.ref('settings/rewards').on('value', snapshot => {
    const rewards = snapshot.val();
    if(rewards){
      rewardSettings.dailyLogin = rewards.dailyLogin || 50;
      rewardSettings.dailyTask = rewards.dailyTask || 100;
      rewardSettings.signupReferralBonus = rewards.signupReferralBonus || 50;
      rewardSettings.dailyRefer = rewards.dailyRefer || 75;
      rewardSettings.total5Refer = rewards.total5Refer || 200;
      rewardSettings.total10Refer = rewards.total10Refer || 500;
      rewardSettings.taskCommissionRate = rewards.taskCommissionRate || 10;
      
      document.getElementById('daily-login-reward-badge').innerText = '+' + rewardSettings.dailyLogin + ' Coins';
      document.getElementById('daily-task-reward-badge').innerText = '+' + rewardSettings.dailyTask + ' Coins';
      document.getElementById('daily-refer-reward-badge').innerText = '+' + rewardSettings.dailyRefer + ' Coins';
      document.getElementById('total-5-refer-reward-badge').innerText = '+' + rewardSettings.total5Refer + ' Coins';
      document.getElementById('total-10-refer-reward-badge').innerText = '+' + rewardSettings.total10Refer + ' Coins';
      
      const totalDaily = rewardSettings.dailyLogin + rewardSettings.dailyTask;
      document.getElementById('daily-task-heading').innerText = 'üéÅ Daily Tasks (' + totalDaily + '+ Coins)';
      
      console.log('‚úÖ Reward settings loaded:', rewardSettings);
    }
  });
}

// Load Coin Rate
function loadCoinRate(){
  db.ref('settings/coinRate').on('value', snap => {
    coinRate = snap.val() || 1;
    document.getElementById('display-coin-rate').innerText = coinRate;
    console.log('üí∞ Coin rate:', coinRate);
  });
  
  db.ref('settings/withdraw/minAmount').on('value', snap => {
    minWithdrawAmount = snap.val() || 100;
  });
}

// Coin Converter
function convertCoins(){
  const coinsInput = document.getElementById('converter-coins').value;
  const withdrawAmountInput = document.getElementById('withdraw-amount').value;
  
  let coins = 0;
  
  if(coinsInput && parseFloat(coinsInput) > 0){
    coins = parseFloat(coinsInput);
    document.getElementById('withdraw-amount').value = coins;
  } else if(withdrawAmountInput && parseFloat(withdrawAmountInput) > 0){
    coins = parseFloat(withdrawAmountInput);
    document.getElementById('converter-coins').value = coins;
  }
  
  const bdt = (coins * coinRate).toFixed(2);
  document.getElementById('converter-bdt').value = bdt + ' BDT';
}

// Daily Timer
function updateDailyTimer(){
  const now = new Date();
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(0,0,0,0);
  
  const diff = tomorrow - now;
  const hours = Math.floor(diff / (1000 * 60 * 60));
  const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((diff % (1000 * 60)) / 1000);
  
  document.getElementById('daily-timer').innerText = 
    `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
}

setInterval(updateDailyTimer, 1000);

// Get Today's Date Key
function getTodayKey(){
  const today = new Date();
  return today.getFullYear() + '-' + (today.getMonth()+1) + '-' + today.getDate();
}

// Load Notifications
function loadNotifications(){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  
  db.ref('notifications/' + uid).on('value', snapshot => {
    const container = document.getElementById('notifications-list');
    container.innerHTML = '';
    
    let unreadCount = 0;
    const notifications = [];
    
    snapshot.forEach(childSnapshot => {
      const notif = childSnapshot.val();
      notif.key = childSnapshot.key;
      notifications.push(notif);
      
      if(!notif.read) unreadCount++;
    });
    
    const countElem = document.getElementById('notification-count');
    if(unreadCount > 0){
      countElem.innerText = unreadCount;
      countElem.style.display = 'block';
    } else {
      countElem.style.display = 'none';
    }
    
    if(notifications.length === 0){
      container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-secondary);">No notifications</div>';
      return;
    }
    
    notifications.sort((a, b) => b.timestamp - a.timestamp);
    
    notifications.forEach(notif => {
      const div = document.createElement('div');
      div.className = 'notification-item' + (!notif.read ? ' unread' : '');
      div.innerHTML = `
        <div class="notification-header">
          <div class="notification-title">
            ${notif.title}
            ${!notif.read ? '<span class="notification-badge">NEW</span>' : ''}
          </div>
          <div class="notification-date">${notif.date || ''}</div>
        </div>
        <div class="notification-message">${notif.message}</div>
      `;
      
      div.onclick = () => markAsRead(notif.key);
      container.appendChild(div);
    });
  });
}

function markAsRead(key){
  if(!currentUser) return;
  const uid = currentUser.uid;
  db.ref('notifications/' + uid + '/' + key).update({read: true});
}

// Load Leaderboard - COMPLETE FIXED VERSION
function loadLeaderboard(){
  const container = document.getElementById('leaderboard-list');
  
  container.innerHTML = `
    <div style="text-align:center;padding:40px;color:var(--text-secondary);">
      <div style="font-size:50px;margin-bottom:15px;animation:spin 2s linear infinite;">‚è≥</div>
      <div style="font-size:16px;">Loading leaderboard...</div>
    </div>
  `;
  
  console.log('üèÜ Loading leaderboard...');
  
  db.ref('users').once('value')
    .then(snapshot => {
      const users = [];
      
      console.log('üìä Total users in database:', snapshot.numChildren());
      
      snapshot.forEach(childSnapshot => {
        const user = childSnapshot.val();
        const uid = childSnapshot.key;
        
        if(user && user.totalEarned && user.totalEarned > 0){
          users.push({
            uid: uid,
            name: user.name || 'User',
            email: user.email || '',
            phone: user.phone || '',
            totalEarned: user.totalEarned || 0,
            balance: user.balance || 0,
            referrals: user.referrals ? Object.keys(user.referrals).length : 0
          });
        }
      });
      
      console.log('‚úÖ Users with earnings found:', users.length);
      
      users.sort((a, b) => b.totalEarned - a.totalEarned);
      
      container.innerHTML = '';
      
      if(users.length === 0){
        container.innerHTML = `
          <div style="text-align:center;padding:50px;color:var(--text-secondary);">
            <div style="font-size:80px;margin-bottom:20px;">üèÜ</div>
            <div style="font-size:20px;font-weight:700;margin-bottom:10px;color:var(--text-primary);">No Rankings Yet</div>
            <div style="font-size:14px;line-height:1.6;">
              Complete tasks to be the first on the leaderboard!<br>
              Start earning coins and climb to the top! üöÄ
            </div>
          </div>
        `;
        return;
      }
      
      const statsDiv = document.createElement('div');
      statsDiv.style.cssText = 'background:linear-gradient(135deg,rgba(102,126,234,0.2),rgba(118,75,162,0.2));padding:15px;border-radius:10px;margin-bottom:20px;text-align:center;border:1px solid rgba(102,126,234,0.3);';
      statsDiv.innerHTML = `
        <div style="font-size:24px;margin-bottom:5px;">üèÜ Top Earners</div>
        <div style="font-size:13px;color:var(--text-secondary);">Total Players: ${users.length}</div>
      `;
      container.appendChild(statsDiv);
      
      users.forEach((user, index) => {
        const rank = index + 1;
        const isCurrentUser = currentUser && user.uid === currentUser.uid;
        
        let rankBadgeContent = '#' + rank;
        let rankClass = '';
        let itemClass = '';
        
        if(rank === 1){
          rankBadgeContent = 'ü•á';
          rankClass = 'gold';
          itemClass = 'top1';
        } else if(rank === 2){
          rankBadgeContent = 'ü•à';
          rankClass = 'silver';
          itemClass = 'top2';
        } else if(rank === 3){
          rankBadgeContent = 'ü•â';
          rankClass = 'bronze';
          itemClass = 'top3';
        }
        
        if(isCurrentUser){
          itemClass += ' current-user';
        }
        
        const div = document.createElement('div');
        div.className = 'leaderboard-item ' + itemClass;
        div.innerHTML = `
          <div class="rank-badge ${rankClass}">${rankBadgeContent}</div>
          <div class="leaderboard-info">
            <div class="leaderboard-name">
              ${user.name}
              ${isCurrentUser ? ' <span style="color:#ffd700;font-size:12px;font-weight:700;">(You)</span>' : ''}
              ${rank <= 3 ? ' <span style="font-size:16px;">üëë</span>' : ''}
            </div>
            <div class="leaderboard-earned">
              Total Earned: <span>${user.totalEarned.toLocaleString()} coins</span>
              ${user.referrals > 0 ? ` ‚Ä¢ ${user.referrals} referrals` : ''}
            </div>
          </div>
        `;
        
        container.appendChild(div);
      });
      
      if(currentUser){
        const currentUserData = users.find(u => u.uid === currentUser.uid);
        
        if(currentUserData){
          const rank = users.indexOf(currentUserData) + 1;
          const footerDiv = document.createElement('div');
          footerDiv.style.cssText = 'margin-top:20px;padding:15px;background:linear-gradient(135deg,rgba(46,204,113,0.2),rgba(39,174,96,0.2));border-radius:10px;text-align:center;border:1px solid rgba(46,204,113,0.3);';
          footerDiv.innerHTML = `
            <div style="font-size:14px;color:var(--text-primary);margin-bottom:5px;">
              <strong>Your Rank: #${rank}</strong> out of ${users.length} players
            </div>
            <div style="font-size:12px;color:var(--text-secondary);">
              Keep completing tasks to climb higher! üöÄ
            </div>
          `;
          container.appendChild(footerDiv);
        } else {
          const footerDiv = document.createElement('div');
          footerDiv.style.cssText = 'margin-top:20px;padding:15px;background:rgba(255,193,7,0.2);border-radius:10px;text-align:center;border:1px solid rgba(255,193,7,0.3);';
          footerDiv.innerHTML = `
            <div style="font-size:14px;color:#ffc107;margin-bottom:5px;">
              <strong>üí° You're not ranked yet</strong>
            </div>
            <div style="font-size:12px;color:var(--text-secondary);">
              Complete tasks to appear on the leaderboard!
            </div>
          `;
          container.appendChild(footerDiv);
        }
      }
      
      console.log('‚úÖ Leaderboard loaded successfully with', users.length, 'users');
    })
    .catch(error => {
      console.error('‚ùå Leaderboard error:', error);
      
      container.innerHTML = `
        <div style="text-align:center;padding:40px;">
          <div style="font-size:60px;margin-bottom:15px;color:var(--red);">‚ö†Ô∏è</div>
          <div style="font-size:18px;color:var(--text-primary);margin-bottom:10px;font-weight:700;">
            Failed to Load Leaderboard
          </div>
          <div style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;padding:10px;background:rgba(255,107,107,0.1);border-radius:8px;">
            ${error.message || 'Unknown error occurred'}
          </div>
          <button onclick="loadLeaderboard()" style="padding:12px 24px;background:linear-gradient(135deg,var(--primary),#3a7bc8);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;transition:0.3s;">
            üîÑ Retry
          </button>
        </div>
      `;
    });
}

// Load Profile Settings
function loadProfileSettings(){
  if(!userData) return;
  
  document.getElementById('profile-name').innerText = userData.name || 'N/A';
  document.getElementById('profile-phone').innerText = userData.phone || 'N/A';
  document.getElementById('profile-email').innerText = userData.email || 'N/A';
  document.getElementById('profile-uid').innerText = userData.userID || 'N/A';
  
  const joinDate = userData.createdAt ? new Date(userData.createdAt).toLocaleDateString() : 'N/A';
  document.getElementById('profile-joined').innerText = joinDate;
  
  document.getElementById('profile-balance').innerText = (userData.balance || 0) + ' coins';
  document.getElementById('profile-earned').innerText = (userData.totalEarned || 0) + ' coins';
  document.getElementById('profile-withdrawn').innerText = (userData.totalWithdrawn || 0) + ' coins';
  document.getElementById('profile-pending').innerText = (userData.pendingWithdraw || 0) + ' coins';
  
  const referralCount = userData.referrals ? Object.keys(userData.referrals).length : 0;
  document.getElementById('profile-referrals').innerText = referralCount;
}

// Load Daily Tasks
function loadDailyTasks(){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  const todayKey = getTodayKey();
  
  db.ref('users/' + uid + '/dailyTasks/' + todayKey).on('value', snapshot => {
    dailyData = snapshot.val() || {};
    
    const loginBtn = document.getElementById('daily-login-btn');
    const loginProgress = document.getElementById('login-progress');
    if(dailyData.loginClaimed){
      loginBtn.disabled = true;
      loginBtn.innerText = '‚úÖ Claimed';
      loginProgress.style.width = '100%';
    } else {
      loginBtn.disabled = false;
      loginBtn.innerText = 'Claim Reward';
      loginProgress.style.width = '0%';
    }
    
    const tasksCompleted = Object.keys(completedTasks).filter(key => {
      const task = completedTasks[key];
      return task.completedAt && new Date(task.completedAt).toDateString() === new Date().toDateString();
    }).length;
    
    const taskBtn = document.getElementById('daily-task-btn');
    const taskProgress = document.getElementById('task-progress');
    const taskPercent = Math.min((tasksCompleted / 3) * 100, 100);
    taskProgress.style.width = taskPercent + '%';
    
    if(dailyData.tasksClaimed){
      taskBtn.disabled = true;
      taskBtn.innerText = '‚úÖ Claimed';
    } else if(tasksCompleted >= 3){
      taskBtn.disabled = false;
      taskBtn.innerText = 'Claim Reward';
    } else {
      taskBtn.disabled = true;
      taskBtn.innerText = tasksCompleted + '/3 Completed';
    }
  });
}

// Load Referral Rewards
function loadReferralRewards(){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  const todayKey = getTodayKey();
  
  const todayReferrals = userData.referrals ? Object.values(userData.referrals).filter(ref => {
    return ref.joinedAt && new Date(ref.joinedAt).toDateString() === new Date().toDateString();
  }).length : 0;
  
  const totalReferrals = userData.referrals ? Object.keys(userData.referrals).length : 0;
  
  const dailyReferBtn = document.getElementById('daily-refer-btn');
  const dailyReferProgress = document.getElementById('daily-refer-progress');
  const dailyPercent = Math.min((todayReferrals / 1) * 100, 100);
  dailyReferProgress.style.width = dailyPercent + '%';
  
  db.ref('users/' + uid + '/dailyTasks/' + todayKey + '/referClaimed').once('value').then(snap => {
    if(snap.val()){
      dailyReferBtn.disabled = true;
      dailyReferBtn.innerText = '‚úÖ Claimed';
    } else if(todayReferrals >= 1){
      dailyReferBtn.disabled = false;
      dailyReferBtn.innerText = 'Claim Reward';
    } else {
      dailyReferBtn.disabled = true;
      dailyReferBtn.innerText = todayReferrals + '/1 Invited Today';
    }
  });
  
  const total5Btn = document.getElementById('total-5-refer-btn');
  const total5Progress = document.getElementById('total-5-refer-progress');
  const percent5 = Math.min((totalReferrals / 5) * 100, 100);
  total5Progress.style.width = percent5 + '%';
  
  db.ref('users/' + uid + '/referralRewards/total5Claimed').once('value').then(snap => {
    if(snap.val()){
      total5Btn.disabled = true;
      total5Btn.innerText = '‚úÖ Claimed';
    } else if(totalReferrals >= 5){
      total5Btn.disabled = false;
      total5Btn.innerText = 'Claim Reward';
    } else {
      total5Btn.disabled = true;
      total5Btn.innerText = totalReferrals + '/5 Invited';
    }
  });
  
  const total10Btn = document.getElementById('total-10-refer-btn');
  const total10Progress = document.getElementById('total-10-refer-progress');
  const percent10 = Math.min((totalReferrals / 10) * 100, 100);
  total10Progress.style.width = percent10 + '%';
  
  db.ref('users/' + uid + '/referralRewards/total10Claimed').once('value').then(snap => {
    if(snap.val()){
      total10Btn.disabled = true;
      total10Btn.innerText = '‚úÖ Claimed';
    } else if(totalReferrals >= 10){
      total10Btn.disabled = false;
      total10Btn.innerText = 'Claim Reward';
    } else {
      total10Btn.disabled = true;
      total10Btn.innerText = totalReferrals + '/10 Invited';
    }
  });
}

// Claim Daily Login
function claimDailyLogin(){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  const todayKey = getTodayKey();
  const reward = rewardSettings.dailyLogin;
  
  db.ref('users/' + uid).once('value').then(snapshot => {
    const data = snapshot.val();
    const newBalance = (data.balance || 0) + reward;
    const newTotalEarned = (data.totalEarned || 0) + reward;
    
    return db.ref('users/' + uid).update({
      balance: newBalance,
      totalEarned: newTotalEarned,
      ['dailyTasks/' + todayKey + '/loginClaimed']: true
    });
  }).then(() => {
    alert('üéâ You earned ' + reward + ' coins from Daily Login!');
  });
}

// Claim Daily Task
function claimDailyTask(){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  const todayKey = getTodayKey();
  const reward = rewardSettings.dailyTask;
  
  db.ref('users/' + uid).once('value').then(snapshot => {
    const data = snapshot.val();
    const newBalance = (data.balance || 0) + reward;
    const newTotalEarned = (data.totalEarned || 0) + reward;
    
    return db.ref('users/' + uid).update({
      balance: newBalance,
      totalEarned: newTotalEarned,
      ['dailyTasks/' + todayKey + '/tasksClaimed']: true
    });
  }).then(() => {
    alert('üéâ You earned ' + reward + ' coins for completing 3 tasks!');
  });
}

// Claim Daily Referral
function claimDailyRefer(){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  const todayKey = getTodayKey();
  const reward = rewardSettings.dailyRefer;
  
  db.ref('users/' + uid).once('value').then(snapshot => {
    const data = snapshot.val();
    const newBalance = (data.balance || 0) + reward;
    const newTotalEarned = (data.totalEarned || 0) + reward;
    
    return db.ref('users/' + uid).update({
      balance: newBalance,
      totalEarned: newTotalEarned,
      ['dailyTasks/' + todayKey + '/referClaimed']: true
    });
  }).then(() => {
    alert('üéâ You earned ' + reward + ' coins for inviting a friend today!');
    loadReferralRewards();
  });
}

// Claim Total Referrals
function claimTotalRefer(count){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  const rewardKey = 'total' + count + 'Claimed';
  let reward;
  
  if(count === 5) reward = rewardSettings.total5Refer;
  else if(count === 10) reward = rewardSettings.total10Refer;
  else return;
  
  db.ref('users/' + uid).once('value').then(snapshot => {
    const data = snapshot.val();
    const newBalance = (data.balance || 0) + reward;
    const newTotalEarned = (data.totalEarned || 0) + reward;
    
    return db.ref('users/' + uid).update({
      balance: newBalance,
      totalEarned: newTotalEarned,
      ['referralRewards/' + rewardKey]: true
    });
  }).then(() => {
    alert('üéâ You earned ' + reward + ' coins for inviting ' + count + ' friends!');
    loadReferralRewards();
  });
}

// AUTH
function toggleAuthMode(){
  isSignupMode = !isSignupMode;
  const signupFields = document.getElementById('signup-fields');
  const authTitle = document.getElementById('auth-title');
  const authBtn = document.getElementById('auth-btn');
  const toggleText = document.getElementById('toggle-auth');
  
  if(isSignupMode){
    signupFields.style.display = 'block';
    authTitle.innerText = 'Sign Up';
    authBtn.innerText = 'Create Account';
    toggleText.innerText = 'Already have an account? Login';
  } else {
    signupFields.style.display = 'none';
    authTitle.innerText = 'Take Master';
    authBtn.innerText = 'Login';
    toggleText.innerText = "Don't have an account? Sign Up";
  }
  clearError('auth-error');
}

function handleAuth(){
  if(isSignupMode) signup();
  else login();
}

function signup(){
  const name = document.getElementById('signup-name').value.trim();
  const phone = document.getElementById('signup-phone').value.trim();
  const email = document.getElementById('auth-email').value.trim();
  const password = document.getElementById('auth-password').value;
  
  const urlParams = new URLSearchParams(window.location.search);
  const referredBy = urlParams.get('ref');
  
  clearError('auth-error');
  
  if(!name || !phone || !email || !password){ 
    showError('auth-error', 'Please fill all fields');
    return; 
  }
  if(password.length < 6){
    showError('auth-error', 'Password must be at least 6 characters');
    return;
  }
  if(!/^01[0-9]{9}$/.test(phone)){
    showError('auth-error', 'Valid phone number required (11 digits)');
    return;
  }
  
  console.log('üìù Creating new user account...');
  
  auth.createUserWithEmailAndPassword(email, password).then(cred=>{
    currentUser = cred.user;
    const uid = currentUser.uid;
    const userID = generateUserID();
    
    const newUserData = {
      name: name,
      phone: phone,
      email: email,
      uid: uid,
      userID: userID,
      balance: 0,
      totalEarned: 0,
      totalWithdrawn: 0,
      pendingWithdraw: 0,
      completedTasks: {},
      referrals: {},
      referralEarnings: 0,
      referredBy: referredBy || null,
      createdAt: Date.now()
    };
    
    return db.ref('users/'+uid).set(newUserData).then(() => {
      if(referredBy){
        db.ref('users').orderByChild('userID').equalTo(referredBy).once('value').then(snapshot => {
          snapshot.forEach(childSnapshot => {
            const referrerUid = childSnapshot.key;
            const referrerData = childSnapshot.val();
            
            const newReferrals = referrerData.referrals || {};
            newReferrals[uid] = {
              name: name,
              userID: userID,
              joinedAt: Date.now()
            };
            
            const referralBonus = rewardSettings.signupReferralBonus;
            const newBalance = (referrerData.balance || 0) + referralBonus;
            const newTotalEarned = (referrerData.totalEarned || 0) + referralBonus;
            const newReferralEarnings = (referrerData.referralEarnings || 0) + referralBonus;
            
            db.ref('users/' + referrerUid).update({
              referrals: newReferrals,
              balance: newBalance,
              totalEarned: newTotalEarned,
              referralEarnings: newReferralEarnings
            });
            
            db.ref('notifications/' + referrerUid).push({
              title: 'üéâ New Referral!',
              message: `${name} joined using your referral link! You earned ${referralBonus} coins.`,
              type: 'referral',
              timestamp: Date.now(),
              date: new Date().toLocaleString(),
              read: false
            });
          });
        });
      }
    });
  }).then(()=>{
    clearError('auth-error');
    console.log('‚úÖ Signup successful');
  }).catch(err=>{
    console.error('‚ùå Signup error:', err);
    showError('auth-error', err.message);
  });
}

function login(){
  const email = document.getElementById('auth-email').value.trim();
  const password = document.getElementById('auth-password').value;
  
  clearError('auth-error');
  
  if(!email || !password){
    showError('auth-error', 'Please enter email and password');
    return;
  }
  
  console.log('üîê Logging in...');
  
  auth.signInWithEmailAndPassword(email, password).then(cred=>{
    currentUser = cred.user;
    clearError('auth-error');
    console.log('‚úÖ Login successful');
  }).catch(err=>{
    console.error('‚ùå Login error:', err);
    showError('auth-error', 'Invalid email or password');
  });
}

function logout(){
  if(confirm('Are you sure you want to logout?')){
    auth.signOut().then(()=>{
      currentUser = null;
      userBalance = 0;
      showLoginForm();
      console.log('üö™ Logged out');
    });
  }
}

function showLoginForm(){
  document.getElementById('auth-section').style.display='block';
  document.getElementById('dashboard').style.display='none';
  isSignupMode = false;
  document.getElementById('signup-fields').style.display = 'none';
}

function showDashboard(){
  document.getElementById('auth-section').style.display='none';
  document.getElementById('dashboard').style.display='block';
  loadUserProfile();
  loadNotice();
  loadWithdrawNotice();
  loadCoinRate();
  loadRewardSettings();
  loadDailyTasks();
  loadNotifications();
  console.log('‚úÖ Dashboard loaded');
}

// SIDEBAR
function openMenu(){
  document.getElementById('side-menu').classList.add('open');
  document.querySelector('.menu-bg').style.display='block';
}

function closeMenu(){
  document.getElementById('side-menu').classList.remove('open');
  document.querySelector('.menu-bg').style.display='none';
}

function showSection(id){
  const sections = ['dashboard-content', 'tasks-section', 'withdraw-section', 'refer-section', 'wallet-section', 'help-section', 'leaderboard-section', 'notifications-section', 'profile-section'];
  
  sections.forEach(s => {
    document.getElementById(s).style.display = 'none';
  });
  
  document.querySelectorAll('.menu-list li').forEach(li => li.classList.remove('active'));
  
  if(id === 'dashboard'){
    document.getElementById('dashboard-content').style.display = 'block';
  } else if(id === 'tasks-section'){
    document.getElementById('tasks-section').style.display = 'block';
    loadTasks();
  } else if(id === 'withdraw-section'){
    document.getElementById('withdraw-section').style.display = 'block';
    loadWithdrawPage();
  } else if(id === 'refer-section'){
    document.getElementById('refer-section').style.display = 'block';
    loadReferPage();
    loadReferralRewards();
  } else if(id === 'wallet-section'){
    document.getElementById('wallet-section').style.display = 'block';
    loadWalletPage();
  } else if(id === 'leaderboard-section'){
    document.getElementById('leaderboard-section').style.display = 'block';
    loadLeaderboard();
  } else if(id === 'notifications-section'){
    document.getElementById('notifications-section').style.display = 'block';
    if(currentUser){
      db.ref('notifications/' + currentUser.uid).once('value').then(snapshot => {
        snapshot.forEach(childSnapshot => {
          childSnapshot.ref.update({read: true});
        });
      });
    }
  } else if(id === 'profile-section'){
    document.getElementById('profile-section').style.display = 'block';
    loadProfileSettings();
  } else {
    document.getElementById(id).style.display = 'block';
  }
  
  closeMenu();
}

// USER PROFILE
function loadUserProfile(){
  if(!currentUser) return;
  const uid = currentUser.uid;
  
  db.ref('users/'+uid).on('value', snapshot=>{
    const data = snapshot.val();
    if(!data) return;
    
    userData = data;
    userBalance = data.balance || 0;
    totalEarned = data.totalEarned || 0;
    completedTasks = data.completedTasks || {};
    
    let userID = data.userID;
    if(!userID){
      userID = generateUserID();
      db.ref('users/'+uid).update({ userID: userID });
    }
    
    document.getElementById('user-name').innerText = data.name;
    document.getElementById('user-phone').innerText = 'üì± ' + data.phone;
    document.getElementById('user-uid').innerText = 'üÜî ' + userID;
    document.getElementById('user-balance').innerText = userBalance;
    
    loadDailyTasks();
    
    console.log('‚úÖ User profile loaded:', data.name);
  });
}

// NOTICE
function loadNotice(){
  db.ref('notice_board/text').on('value', snap=>{
    const txt = snap.val() || 'Welcome to Take Master Dashboard!';
    document.getElementById('notice-text').innerText = txt;
  });
}

// WITHDRAW NOTICE
function loadWithdrawNotice(){
  db.ref('settings/withdrawNotice').on('value', snap=>{
    const txt = snap.val() || 'Please ensure your account details are correct before submitting withdrawal request.';
    document.getElementById('withdraw-notice-text').innerText = txt;
  });
}

// TASKS
function loadTasks(){
  db.ref('tasks').once('value').then(snapshot=>{
    const tasks = snapshot.val();
    const container = document.getElementById('tasks-list');
    container.innerHTML = '';
    
    if(!tasks){
      container.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">No tasks available</p>';
      return;
    }
    
    Object.entries(tasks).forEach(([key, t]) => {
      const isCompleted = completedTasks[key] ? true : false;
      
      const div = document.createElement('div');
      div.className = 'task-box' + (isCompleted ? ' completed' : '');
      div.innerHTML = `
        <div class="task-info">
          <strong>${t.name || 'Task'}</strong>
          <div class="task-reward">üéÅ Reward: ${t.reward || 0} coins</div>
        </div>
        <div class="task-actions" id="task-action-${key}">
          ${isCompleted ? 
            '<span class="completed-badge">‚úÖ Completed</span>' :
            `<button class="claim-btn" onclick="openTask('${t.link}', '${key}')">Start</button>`
          }
        </div>
      `;
      container.appendChild(div);
    });
  });
}

function openTask(link, taskId){
  if(link && link !== 'undefined'){
    window.open(link, '_blank');
    
    const actionDiv = document.getElementById('task-action-' + taskId);
    if(actionDiv){
      actionDiv.innerHTML = `<button class="complete-btn" onclick="completeTask('${taskId}')">Complete</button>`;
    }
  } else {
    alert('Task link not found');
  }
}

function completeTask(taskId){
  if(!currentUser) return;
  
  const uid = currentUser.uid;
  
  db.ref('tasks/' + taskId).once('value').then(taskSnap => {
    const task = taskSnap.val();
    if(!task) return;
    
    const reward = task.reward || 0;
    
    return db.ref('users/' + uid).once('value').then(userSnap => {
      const userData = userSnap.val();
      const newBalance = (userData.balance || 0) + reward;
      const newTotalEarned = (userData.totalEarned || 0) + reward;
      const updatedCompletedTasks = userData.completedTasks || {};
      
      updatedCompletedTasks[taskId] = {
        completedAt: Date.now(),
        reward: reward,
        taskName: task.name
      };
      
      if(userData.referredBy){
        db.ref('users').orderByChild('userID').equalTo(userData.referredBy).once('value').then(snapshot => {
          snapshot.forEach(childSnapshot => {
            const referrerUid = childSnapshot.key;
            const referrerData = childSnapshot.val();
            
            const commission = Math.floor(reward * (rewardSettings.taskCommissionRate / 100));
            const newReferrerBalance = (referrerData.balance || 0) + commission;
            const newReferrerTotalEarned = (referrerData.totalEarned || 0) + commission;
            const newReferralEarnings = (referrerData.referralEarnings || 0) + commission;
            
            db.ref('users/' + referrerUid).update({
              balance: newReferrerBalance,
              totalEarned: newReferrerTotalEarned,
              referralEarnings: newReferralEarnings
            });
          });
        });
      }
      
      return db.ref('users/' + uid).update({
        balance: newBalance,
        totalEarned: newTotalEarned,
        completedTasks: updatedCompletedTasks
      }).then(() => {
        const actionDiv = document.getElementById('task-action-' + taskId);
        if(actionDiv){
          actionDiv.innerHTML = '<span class="completed-badge">‚úÖ Completed</span>';
          actionDiv.parentElement.classList.add('completed');
        }
        
        alert(`üéâ Congratulations! You earned ${reward} coins!`);
        loadDailyTasks();
      });
    });
  });
}

// WITHDRAW - FIXED VERSION
function loadWithdrawPage(){
  document.getElementById('withdraw-balance').innerText = userBalance;
  document.getElementById('converter-coins').value = '';
  document.getElementById('converter-bdt').value = '';
  document.getElementById('withdraw-amount').value = '';
  document.getElementById('withdraw-account').value = '';
}

function selectMethod(method){
  selectedWithdrawMethod = method;
  document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('withdraw-method').value = method;
}

function submitWithdraw(){
  const method = document.getElementById('withdraw-method').value.trim();
  const account = document.getElementById('withdraw-account').value.trim();
  const amountInput = document.getElementById('withdraw-amount').value;
  
  clearError('withdraw-error');
  clearError('withdraw-success');
  
  console.log('üí∏ Starting withdraw submission...', {method, account, amountInput});
  
  if(!currentUser){
    showError('withdraw-error', '‚ö†Ô∏è Please login first');
    console.error('‚ùå No current user');
    return;
  }
  
  if(!userData || !userData.userID){
    showError('withdraw-error', '‚ö†Ô∏è User profile not loaded. Please refresh the page.');
    console.error('‚ùå User data not loaded:', userData);
    return;
  }
  
  if(!method){
    showError('withdraw-error', '‚ö†Ô∏è Please select payment method');
    return;
  }
  
  if(!account){
    showError('withdraw-error', '‚ö†Ô∏è Please enter account number');
    return;
  }
  
  const amount = parseInt(amountInput);
  
  if(!amountInput || isNaN(amount) || amount <= 0){
    showError('withdraw-error', '‚ö†Ô∏è Please enter valid amount');
    return;
  }
  
  if(amount < minWithdrawAmount){
    showError('withdraw-error', `‚ö†Ô∏è Minimum withdraw amount is ${minWithdrawAmount} coins`);
    return;
  }
  
  if(amount > userBalance){
    showError('withdraw-error', '‚ö†Ô∏è Insufficient balance! Your balance: ' + userBalance + ' coins');
    return;
  }
  
  if(!confirm(`Are you sure you want to withdraw ${amount} coins?`)){
    return;
  }
  
  const submitBtn = document.getElementById('withdraw-submit-btn');
  if(submitBtn){
    submitBtn.disabled = true;
    submitBtn.innerText = '‚è≥ Processing...';
  }
  
  const uid = currentUser.uid;
  const bdtAmount = (amount * coinRate).toFixed(2);
  
  console.log('üí∏ Processing withdrawal...', {
    uid,
    amount, 
    bdtAmount, 
    method, 
    account,
    userBalance,
    userData: userData
  });
  
  const withdrawData = {
    uid: uid,
    userID: userData.userID || 'N/A',
    userName: userData.name || 'Unknown',
    userPhone: userData.phone || 'N/A',
    userEmail: userData.email || currentUser.email || 'N/A',
    method: method,
    account: account,
    amount: amount,
    bdtAmount: parseFloat(bdtAmount),
    coinRate: coinRate,
    status: 'pending',
    requestedAt: Date.now(),
    date: new Date().toLocaleString()
  };
  
  console.log('üìù Withdraw data prepared:', withdrawData);
  
  const newBalance = userBalance - amount;
  const newPending = (userData.pendingWithdraw || 0) + amount;
  
  console.log('üí∞ New balances:', {newBalance, newPending});
  
  db.ref('users/' + uid).update({
    balance: newBalance,
    pendingWithdraw: newPending
  })
  .then(() => {
    console.log('‚úÖ Balance updated successfully');
    return db.ref('withdraw_requests').push(withdrawData);
  })
  .then(() => {
    console.log('‚úÖ Withdrawal request submitted successfully to Firebase');
    
    showSuccess('withdraw-success', `‚úÖ Withdraw request submitted successfully! ${amount} coins deducted from your balance. You will receive ${bdtAmount} BDT within 24-48 hours.`);
    
    document.getElementById('withdraw-account').value = '';
    document.getElementById('withdraw-amount').value = '';
    document.getElementById('converter-coins').value = '';
    document.getElementById('converter-bdt').value = '';
    
    if(submitBtn){
      submitBtn.disabled = false;
      submitBtn.innerText = 'üí∏ Request Withdraw';
    }
    
    db.ref('notifications/' + uid).push({
      title: 'üí∏ Withdraw Request Submitted',
      message: `Your withdraw request of ${amount} coins (${bdtAmount} BDT) has been submitted successfully. Please wait for admin approval.`,
      type: 'withdraw',
      timestamp: Date.now(),
      date: new Date().toLocaleString(),
      read: false
    });
    
    console.log('‚úÖ Notification sent to user');
    
    setTimeout(() => {
      clearError('withdraw-success');
      showSection('dashboard');
    }, 3000);
  })
  .catch(error => {
    console.error('‚ùå Withdraw error:', error);
    console.error('Error details:', {
      code: error.code,
      message: error.message,
      stack: error.stack
    });
    
    showError('withdraw-error', '‚ùå Failed to submit withdraw request: ' + (error.message || 'Unknown error. Please try again.'));
    
    db.ref('users/' + uid).update({
      balance: userBalance,
      pendingWithdraw: userData.pendingWithdraw || 0
    }).then(() => {
      console.log('‚úÖ Balance restored after error');
    }).catch(restoreError => {
      console.error('‚ùå Failed to restore balance:', restoreError);
    });
    
    if(submitBtn){
      submitBtn.disabled = false;
      submitBtn.innerText = 'üí∏ Request Withdraw';
    }
  });
}

// REFER
function loadReferPage(){
  const referrals = userData.referrals || {};
  const totalReferrals = Object.keys(referrals).length;
  const referralEarnings = userData.referralEarnings || 0;
  
  document.getElementById('total-referrals').innerText = totalReferrals;
  document.getElementById('refer-earnings').innerText = referralEarnings;
  
  const referLink = window.location.origin + window.location.pathname + '?ref=' + userData.userID;
  document.getElementById('refer-link').value = referLink;
}

function copyReferLink(){
  const link = document.getElementById('refer-link');
  link.select();
  link.setSelectionRange(0, 99999);
  document.execCommand('copy');
  alert('‚úÖ Referral link copied!');
}

// WALLET
function loadWalletPage(){
  document.getElementById('wallet-current-balance').innerText = userBalance;
  document.getElementById('wallet-total-earned').innerText = totalEarned;
  document.getElementById('wallet-withdrawn').innerText = userData.totalWithdrawn || 0;
  document.getElementById('wallet-pending').innerText = userData.pendingWithdraw || 0;
}

// HELP MESSAGE
function submitHelp(){
  const subject = document.getElementById('help-subject').value.trim();
  const message = document.getElementById('help-message').value.trim();
  const submitBtn = document.getElementById('help-submit-btn');
  
  clearError('help-error');
  clearError('help-success');
  
  console.log('üìù Submitting help message...');
  
  if(!subject){
    showError('help-error', '‚ö†Ô∏è Please enter subject');
    return;
  }
  
  if(!message){
    showError('help-error', '‚ö†Ô∏è Please enter message');
    return;
  }
  
  if(!currentUser){
    showError('help-error', '‚ö†Ô∏è Please login first');
    return;
  }
  
  if(!userData || !userData.userID){
    showError('help-error', '‚ö†Ô∏è User profile not loaded. Please refresh the page.');
    return;
  }
  
  submitBtn.disabled = true;
  submitBtn.innerText = 'Sending...';
  
  const messageData = {
    uid: currentUser.uid,
    userID: userData.userID || 'N/A',
    userName: userData.name || 'Unknown',
    userPhone: userData.phone || 'N/A',
    userEmail: userData.email || currentUser.email || 'N/A',
    subject: subject,
    message: message,
    timestamp: Date.now(),
    date: new Date().toLocaleString(),
    status: 'unread'
  };
  
  db.ref('help_messages').push(messageData)
    .then(() => {
      console.log('‚úÖ Message sent successfully!');
      
      showSuccess('help-success', '‚úÖ Your message has been sent successfully! Admin will reply soon.');
      
      document.getElementById('help-subject').value = '';
      document.getElementById('help-message').value = '';
      
      submitBtn.disabled = false;
      submitBtn.innerText = 'üì§ Send Message';
      
      setTimeout(()=>{
        clearError('help-success');
      }, 5000);
    })
    .catch(error => {
      console.error('‚ùå Help message error:', error);
      showError('help-error', '‚ùå Failed to send message: ' + error.message);
      
      submitBtn.disabled = false;
      submitBtn.innerText = 'üì§ Send Message';
    });
}

// HELPER FUNCTIONS
function showError(id, msg){
  const elem = document.getElementById(id);
  if(elem){
    elem.innerText = msg;
    elem.style.display = 'block';
  }
}

function clearError(id){
  const elem = document.getElementById(id);
  if(elem){
    elem.innerText = '';
    elem.style.display = 'none';
  }
}

function showSuccess(id, msg){
  const elem = document.getElementById(id);
  if(elem){
    elem.innerText = msg;
    elem.style.display = 'block';
  }
}

// AUTH STATE
auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    console.log('‚úÖ User authenticated:', user.email);
    showDashboard();
  } else {
    console.log('‚ö†Ô∏è No user authenticated');
    currentUser = null;
    showLoginForm();
  }
});

console.log('‚úÖ All scripts loaded successfully');
</script>
</body>
</html>